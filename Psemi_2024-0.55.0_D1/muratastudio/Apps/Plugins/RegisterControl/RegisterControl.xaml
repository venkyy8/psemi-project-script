<UserControl x:Class="RegisterControl.RegisterControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:RegisterControl.ViewModel"
             xmlns:ctr="clr-namespace:RegisterControl.Classes"
             xmlns:conv="clr-namespace:RegisterControl.Converters"
             xmlns:l="clr-namespace:RegisterControl" 
             xmlns:System="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800" Background="White">

    <UserControl.DataContext>
        <local:PluginViewModel />
    </UserControl.DataContext>

    <UserControl.Resources>
        <ResourceDictionary  Source="Resources\Styles.xaml"/>
    </UserControl.Resources>
    <Grid>
        <Grid x:Name="RegistersTab8Bit">
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <DockPanel Margin="10,0,10,0"  LastChildFill="False">
                <Label x:Name="lblTitle"
                   Content="Register Map"
                   VerticalAlignment="Center"
                   FontWeight="Bold"
                   Foreground="#660000" />
                <Separator Margin="5,10,5,10">
                    <Separator.LayoutTransform>
                        <RotateTransform Angle="90" />
                    </Separator.LayoutTransform>
                </Separator>
                <Label x:Name="lblTitle12"
                           Content="Search"
                           VerticalAlignment="Center" DockPanel.Dock="Left"
                           FontWeight="Bold"
                           Foreground="#660000"/>
                <TextBox x:Name="SearchBox1" FontSize="18" VerticalAlignment="Stretch" DockPanel.Dock="Left" Height="28" Width="220" TextChanged="SearchBox_TextChanged" />

                <Label x:Name="lblSearchResult1"
                           Content="No matching items found!" Visibility="Hidden"
                           VerticalAlignment="Center" DockPanel.Dock="Left"
                           FontWeight="Bold"
                           Foreground="Red"/>
                <Image Source="Images/logowave_xsm-muRata.png" DockPanel.Dock="Right" Height="30" Width="278" />

            </DockPanel>
            <DataGrid x:Name="dataGrid"
                  Grid.Row="1" 
                  ItemsSource="{Binding Registers}"
                  AutoGenerateColumns="False"
                  SelectionMode="Extended"
                  HorizontalGridLinesBrush="Gainsboro"
                  VerticalGridLinesBrush="Gainsboro"
                  CellStyle="{StaticResource DataGridCell}"
                  RowStyle="{StaticResource DataGridRow}" 
                  FontSize="12"
                  BorderBrush="{x:Null}">
                <DataGrid.Columns>

                    <!--Header Column Template-->
                    <DataGridTemplateColumn Header="Name"
                                        Width="SizeToCells"
                                        IsReadOnly="True"
                                        HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                        CanUserReorder="True">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Image Stretch="Uniform" Width="16" Height="16">
                                        <Image.Style>
                                            <Style TargetType="{x:Type Image}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding ReadOnly}" Value="False">
                                                        <Setter Property="Source" Value="Images/Chip_ReadWrite_16.png"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding ReadOnly}" Value="True">
                                                        <Setter Property="Source" Value="Images/Chip_Sealed_16.png"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Image.Style>
                                    </Image>
                                    <TextBlock Text="{Binding Name}"
                                           Margin="3"
                                           FontWeight="Normal"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn x:Name="AddressConv2" Header="Address"
                                    Binding="{Binding Address, Converter={StaticResource HexConverter}, ConverterParameter=X2 }"
                                    IsReadOnly="True"
                                    CanUserReorder="True"
                                    HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                    ElementStyle="{Binding Source={StaticResource CellCenterAlign}}"/>

                    <DataGridTemplateColumn Header="Data"
                                        IsReadOnly="False"
                                        CanUserReorder="True"
                                        HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                        CellStyle="{StaticResource CellCenterAlign}">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBox
                                      Tag="{Binding ID}"
                                      Text="{Binding LastReadValueWithoutFormula, Converter={StaticResource HexStringConverter}, ConverterParameter=X2}"
                                      IsEnabled="{Binding Path=ReadOnly, Converter={StaticResource InverseBooleanConverter}}"
                                      l:KeyDownBehavior.Command="{Binding DataContext.WriteRegisterCommand, ElementName=dataGrid}"
                                      l:HexDigitsOnlyBehavior.IsHexDigitOnly="True"
                                      l:LostFocusMessageBehavior.IsLostFocus="True"
                                      l:LostFocusMessageBehavior.Command="{Binding DataContext.WriteRegisterCommand, ElementName=dataGrid}"
                                      Width="40"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn Header="Value"
                                    Binding="{Binding LastReadString}"
                                    IsReadOnly="True"
                                    CanUserReorder="True"
                                    HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                    ElementStyle="{StaticResource CellCenterAlign}"/>

                    <DataGridTextColumn Header="Unit"
                                    Binding="{Binding Unit}"
                                    IsReadOnly="True"
                                    CanUserReorder="True"
                                    HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                    ElementStyle="{StaticResource CellCenterAlign}"/>

                </DataGrid.Columns>

                <!--Row Template-->
                <DataGrid.RowDetailsTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="60"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="40"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Image Grid.Column="0"
                               Stretch="Uniform"
                               Width="16"
                               Height="16"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center">
                                <Image.Style>
                                    <Style TargetType="{x:Type Image}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ReadOnly}" Value="False">
                                                <Setter Property="Source" Value="Images/Chip_ReadWrite_16.png"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding ReadOnly}" Value="True">
                                                <Setter Property="Source" Value="Images/Chip_Sealed_16.png"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>

                            <Label Grid.Column="1"
                               Content="{Binding Name}"
                               FontWeight="Medium"
                               FontSize="14"
                               HorizontalAlignment="Left"
                               VerticalAlignment="Center" 
                               Visibility="Visible"/>

                            <StackPanel Orientation="Horizontal" Height="Auto" Width="Auto" Grid.Column="1" Grid.Row="1">
                                <ContentControl>
                                    <ContentControl.Style>
                                        <Style TargetType="{x:Type ContentControl}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Path=Size}" Value="2">
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate>
                                                                <StackPanel Orientation="Vertical">
                                                                    <StackPanel Orientation="Horizontal">

                                                                        <!-- Bit 15 -->
                                                                        <StackPanel Orientation="Vertical">
                                                                            <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=32768}"
                                        Tag="{Binding Bits[0]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[0].Name}"
                                        ToolTip="{Binding Bits[0].Description}" />
                                                                            <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 15" />
                                                                        </StackPanel>

                                                                        <!-- Bit 14 -->
                                                                        <StackPanel Orientation="Vertical">
                                                                            <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=16384}"
                                        Tag="{Binding Bits[1]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[1].Name}"
                                        ToolTip="{Binding Bits[1].Description}" />
                                                                            <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 14" />
                                                                        </StackPanel>

                                                                        <!-- Bit 13 -->
                                                                        <StackPanel Orientation="Vertical">
                                                                            <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=8192}"
                                        Tag="{Binding Bits[2]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[2].Name}"
                                        ToolTip="{Binding Bits[2].Description}" />
                                                                            <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 13" />
                                                                        </StackPanel>

                                                                        <!-- Bit 12 -->
                                                                        <StackPanel Orientation="Vertical">
                                                                            <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=4096}"
                                        Tag="{Binding Bits[3]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[3].Name}"
                                        ToolTip="{Binding Bits[3].Description}" />
                                                                            <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 12" />
                                                                        </StackPanel>

                                                                        <!-- Bit 11 -->
                                                                        <StackPanel Orientation="Vertical">
                                                                            <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=2048}"
                                        Tag="{Binding Bits[4]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[4].Name}"
                                        ToolTip="{Binding Bits[4].Description}" />
                                                                            <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 11" />
                                                                        </StackPanel>

                                                                        <!-- Bit 10 -->
                                                                        <StackPanel Orientation="Vertical">
                                                                            <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=1024}"
                                        Tag="{Binding Bits[5]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[5].Name}"
                                        ToolTip="{Binding Bits[5].Description}" />
                                                                            <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 10" />
                                                                        </StackPanel>

                                                                        <!-- Bit 9 -->
                                                                        <StackPanel Orientation="Vertical">
                                                                            <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=512}"
                                        Tag="{Binding Bits[6]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[6].Name}"
                                        ToolTip="{Binding Bits[6].Description}" />
                                                                            <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 9" />
                                                                        </StackPanel>

                                                                        <!-- Bit 8 -->
                                                                        <StackPanel Orientation="Vertical">
                                                                            <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=256}"
                                        Tag="{Binding Bits[7]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[7].Name}"
                                        ToolTip="{Binding Bits[7].Description}" />
                                                                            <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 8" />
                                                                        </StackPanel>

                                                                    </StackPanel>
                                                                    <StackPanel Orientation="Horizontal">

                                                                        <!-- Bit 7 -->
                                                                        <StackPanel Orientation="Vertical">
                                                                            <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=128}"
                                        Tag="{Binding Bits[8]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[8].Name}"
                                        ToolTip="{Binding Bits[8].Description}" />
                                                                            <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 7" />
                                                                        </StackPanel>

                                                                        <!-- Bit 6 -->
                                                                        <StackPanel Orientation="Vertical">
                                                                            <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=64}"
                                        Tag="{Binding Bits[9]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[9].Name}"
                                        ToolTip="{Binding Bits[9].Description}" />
                                                                            <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 6" />
                                                                        </StackPanel>

                                                                        <!-- Bit 5 -->
                                                                        <StackPanel Orientation="Vertical">
                                                                            <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=32}"
                                        Tag="{Binding Bits[10]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[10].Name}"
                                        ToolTip="{Binding Bits[10].Description}" />
                                                                            <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 5" />
                                                                        </StackPanel>

                                                                        <!-- Bit 4 -->
                                                                        <StackPanel Orientation="Vertical">
                                                                            <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=16}"
                                        Tag="{Binding Bits[11]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[11].Name}"
                                        ToolTip="{Binding Bits[11].Description}" />
                                                                            <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 4" />
                                                                        </StackPanel>

                                                                        <!-- Bit 3 -->
                                                                        <StackPanel Orientation="Vertical">
                                                                            <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=8}"
                                        Tag="{Binding Bits[12]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[12].Name}"
                                        ToolTip="{Binding Bits[12].Description}" />
                                                                            <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 3" />
                                                                        </StackPanel>

                                                                        <!-- Bit 2 -->
                                                                        <StackPanel Orientation="Vertical">
                                                                            <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=4}"
                                        Tag="{Binding Bits[13]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[13].Name}"
                                        ToolTip="{Binding Bits[13].Description}" />
                                                                            <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 2" />
                                                                        </StackPanel>

                                                                        <!-- Bit 1 -->
                                                                        <StackPanel Orientation="Vertical">
                                                                            <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=2}"
                                        Tag="{Binding Bits[14]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[14].Name}"
                                        ToolTip="{Binding Bits[14].Description}" />
                                                                            <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 1" />
                                                                        </StackPanel>

                                                                        <!-- Bit 0 -->
                                                                        <StackPanel Orientation="Vertical">
                                                                            <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=1}"
                                        Tag="{Binding Bits[15]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[15].Name}"
                                        ToolTip="{Binding Bits[15].Description}" />
                                                                            <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 0" />
                                                                        </StackPanel>
                                                                    </StackPanel>
                                                                </StackPanel>
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Path=Size}" Value="1">
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate>
                                                                <StackPanel Orientation="Horizontal">

                                                                    <!-- Bit 7 -->
                                                                    <StackPanel Orientation="Vertical">
                                                                        <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=128}"
                                        Tag="{Binding Bits[0]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[0].Name}"
                                        ToolTip="{Binding Bits[0].Description}" />
                                                                        <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 7" />
                                                                    </StackPanel>

                                                                    <!-- Bit 6 -->
                                                                    <StackPanel Orientation="Vertical">
                                                                        <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=64}"
                                        Tag="{Binding Bits[1]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[1].Name}"
                                        ToolTip="{Binding Bits[1].Description}" />
                                                                        <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 6" />
                                                                    </StackPanel>

                                                                    <!-- Bit 5 -->
                                                                    <StackPanel Orientation="Vertical">
                                                                        <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=32}"
                                        Tag="{Binding Bits[2]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[2].Name}"
                                        ToolTip="{Binding Bits[2].Description}" />
                                                                        <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 5" />
                                                                    </StackPanel>

                                                                    <!-- Bit 4 -->
                                                                    <StackPanel Orientation="Vertical">
                                                                        <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=16}"
                                        Tag="{Binding Bits[3]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[3].Name}"
                                        ToolTip="{Binding Bits[3].Description}" />
                                                                        <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 4" />
                                                                    </StackPanel>

                                                                    <!-- Bit 3 -->
                                                                    <StackPanel Orientation="Vertical">
                                                                        <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=8}"
                                        Tag="{Binding Bits[4]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[4].Name}"
                                        ToolTip="{Binding Bits[4].Description}" />
                                                                        <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 3" />
                                                                    </StackPanel>

                                                                    <!-- Bit 2 -->
                                                                    <StackPanel Orientation="Vertical">
                                                                        <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=4}"
                                        Tag="{Binding Bits[5]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[5].Name}"
                                        ToolTip="{Binding Bits[5].Description}" />
                                                                        <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 2" />
                                                                    </StackPanel>

                                                                    <!-- Bit 1 -->
                                                                    <StackPanel Orientation="Vertical">
                                                                        <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=2}"
                                        Tag="{Binding Bits[6]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[6].Name}"
                                        ToolTip="{Binding Bits[6].Description}" />
                                                                        <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 1" />
                                                                    </StackPanel>

                                                                    <!-- Bit 0 -->
                                                                    <StackPanel Orientation="Vertical">
                                                                        <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=1}"
                                        Tag="{Binding Bits[7]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[7].Name}"
                                        ToolTip="{Binding Bits[7].Description}" />
                                                                        <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 0" />
                                                                    </StackPanel>
                                                                </StackPanel>
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ContentControl.Style>
                                </ContentControl>
                            </StackPanel>
                        </Grid>

                    </DataTemplate>
                </DataGrid.RowDetailsTemplate>
            </DataGrid>
        </Grid>

        <TabControl x:Name="Registers16BitTabControl">
            <TabItem Header="Parent Control">
                <Grid x:Name="RegistersTab16Bit">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="5"/>
                        <RowDefinition Height="40"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <DockPanel Margin="10,0,10,0" Grid.Row="1" LastChildFill="False">
                        <Label x:Name="lblTitle0"
                           Content="Register Map"
                           VerticalAlignment="Center"
                           FontWeight="Bold"
                           DockPanel.Dock="Left"
                           Foreground="#660000" />
                        <Separator Margin="5,10,5,10">
                            <Separator.LayoutTransform>
                                <RotateTransform Angle="90" />
                            </Separator.LayoutTransform>
                        </Separator>

                        <Label x:Name="lblTitle1"
                           Content="Search"
                           VerticalAlignment="Center" DockPanel.Dock="Left"
                           FontWeight="Bold"
                           Foreground="#660000"/>

                        <TextBox x:Name="SearchBox" FontSize="18" VerticalAlignment="Stretch" DockPanel.Dock="Left" Height="28" Width="220" TextChanged="SearchBox_TextChanged" />

                        <Label x:Name="lblSearchResult2"
                           Content="No matching items found!" Visibility="Hidden"
                           VerticalAlignment="Center" DockPanel.Dock="Left"
                           FontWeight="Bold"
                           Foreground="Red"/>
                        <Image Source="Images/logowave_xsm-muRata.png" DockPanel.Dock="Right" Height="30" Width="278" />
                    </DockPanel>
                    <DataGrid x:Name="dataGrid2"
                  Grid.Row="2" 
                  ItemsSource="{Binding Registers}"
                  AutoGenerateColumns="False"
                  SelectionMode="Extended"
                  HorizontalGridLinesBrush="Gainsboro"
                  VerticalGridLinesBrush="Gainsboro"
                  CellStyle="{StaticResource DataGridCell}"
                  RowStyle="{StaticResource DataGridRow}" FontSize="12"
                  BorderBrush="{x:Null}">
                        <DataGrid.Columns>

                            <!--Header Column Template-->
                            <DataGridTemplateColumn Header="Name"
                                        Width="SizeToCells"
                                        IsReadOnly="True"
                                        HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                        CanUserReorder="True">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Image Stretch="Uniform" Width="16" Height="16">
                                                <Image.Style>
                                                    <Style TargetType="{x:Type Image}">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding ReadOnly}" Value="False">
                                                                <Setter Property="Source" Value="Images/Chip_ReadWrite_16.png"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding ReadOnly}" Value="True">
                                                                <Setter Property="Source" Value="Images/Chip_Sealed_16.png"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Image.Style>
                                            </Image>
                                            <TextBlock Text="{Binding Name}"
                                           Margin="3"
                                           FontWeight="Normal"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTextColumn x:Name="AddressConv" Header="Address"
                                    Binding="{Binding Address, Converter={StaticResource HexConverter}, ConverterParameter=X3 }"
                                    IsReadOnly="True"
                                    CanUserReorder="True"
                                    HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                    ElementStyle="{Binding Source={StaticResource CellCenterAlign}}"/>

                            <DataGridTemplateColumn Header="Data"
                                        IsReadOnly="False"
                                        CanUserReorder="True"
                                        HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                        CellStyle="{StaticResource CellCenterAlign}">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBox
                                      Tag="{Binding ID}"
                                      Text="{Binding LastReadValueWithoutFormula, Converter={StaticResource HexStringConverter}, ConverterParameter=X3}"
                                      IsEnabled="{Binding Path=ReadOnly, Converter={StaticResource InverseBooleanConverter}}"
                                      l:KeyDownBehavior.Command="{Binding DataContext.WriteRegisterCommand, ElementName=dataGrid2}"
                                      l:HexDigitsOnlyBehavior.IsHexDigitOnly="True"
                                      l:LostFocusMessageBehavior.IsLostFocus="True"
                                      l:LostFocusMessageBehavior.Command="{Binding DataContext.WriteRegisterCommand, ElementName=dataGrid2}"
                                      Width="40"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTextColumn Header="Value"
                                    Binding="{Binding LastReadString}"                                   
                                    IsReadOnly="True"
                                    CanUserReorder="True"
                                    HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                    ElementStyle="{StaticResource CellCenterAlign}"/>

                            <DataGridTextColumn Header="Unit"
                                    Binding="{Binding Unit}"
                                    IsReadOnly="True"
                                    CanUserReorder="True"
                                    HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                    ElementStyle="{StaticResource CellCenterAlign}"/>

                        </DataGrid.Columns>

                        <!--Row Template-->
                        <DataGrid.RowDetailsTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="60"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="40"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <Image Grid.Column="0"
                               Stretch="Uniform"
                               Width="16"
                               Height="16"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center">
                                        <Image.Style>
                                            <Style TargetType="{x:Type Image}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding ReadOnly}" Value="False">
                                                        <Setter Property="Source" Value="Images/Chip_ReadWrite_16.png"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding ReadOnly}" Value="True">
                                                        <Setter Property="Source" Value="Images/Chip_Sealed_16.png"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Image.Style>
                                    </Image>

                                    <Label Grid.Column="1"
                               Content="{Binding Name}"
                               FontWeight="Medium"
                               FontSize="14"
                               HorizontalAlignment="Left"
                               VerticalAlignment="Center" 
                               Visibility="Visible"/>

                                    <StackPanel Orientation="Horizontal" Height="Auto" Width="Auto" Grid.Column="1" Grid.Row="1">
                                        <ContentControl>
                                            <ContentControl.Style>
                                                <Style TargetType="{x:Type ContentControl}">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Path=Size}" Value="2">
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate>
                                                                        <StackPanel Orientation="Vertical">
                                                                            <StackPanel Orientation="Horizontal">

                                                                                <!-- Bit 15 -->
                                                                                <StackPanel Orientation="Vertical">
                                                                                    <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=32768}"
                                        Tag="{Binding Bits[0]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[0].Name}"
                                        ToolTip="{Binding Bits[0].Description}" />
                                                                                    <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 15" />
                                                                                </StackPanel>

                                                                                <!-- Bit 14 -->
                                                                                <StackPanel Orientation="Vertical">
                                                                                    <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=16384}"
                                        Tag="{Binding Bits[1]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[1].Name}"
                                        ToolTip="{Binding Bits[1].Description}" />
                                                                                    <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 14" />
                                                                                </StackPanel>

                                                                                <!-- Bit 13 -->
                                                                                <StackPanel Orientation="Vertical">
                                                                                    <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=8192}"
                                        Tag="{Binding Bits[2]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[2].Name}"
                                        ToolTip="{Binding Bits[2].Description}" />
                                                                                    <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 13" />
                                                                                </StackPanel>

                                                                                <!-- Bit 12 -->
                                                                                <StackPanel Orientation="Vertical">
                                                                                    <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=4096}"
                                        Tag="{Binding Bits[3]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[3].Name}"
                                        ToolTip="{Binding Bits[3].Description}" />
                                                                                    <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 12" />
                                                                                </StackPanel>

                                                                                <!-- Bit 11 -->
                                                                                <StackPanel Orientation="Vertical">
                                                                                    <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=2048}"
                                        Tag="{Binding Bits[4]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[4].Name}"
                                        ToolTip="{Binding Bits[4].Description}" />
                                                                                    <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 11" />
                                                                                </StackPanel>

                                                                                <!-- Bit 10 -->
                                                                                <StackPanel Orientation="Vertical">
                                                                                    <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=1024}"
                                        Tag="{Binding Bits[5]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[5].Name}"
                                        ToolTip="{Binding Bits[5].Description}" />
                                                                                    <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 10" />
                                                                                </StackPanel>

                                                                                <!-- Bit 9 -->
                                                                                <StackPanel Orientation="Vertical">
                                                                                    <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=512}"
                                        Tag="{Binding Bits[6]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[6].Name}"
                                        ToolTip="{Binding Bits[6].Description}" />
                                                                                    <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 9" />
                                                                                </StackPanel>

                                                                                <!-- Bit 8 -->
                                                                                <StackPanel Orientation="Vertical">
                                                                                    <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=256}"
                                        Tag="{Binding Bits[7]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[7].Name}"
                                        ToolTip="{Binding Bits[7].Description}" />
                                                                                    <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 8" />
                                                                                </StackPanel>

                                                                            </StackPanel>
                                                                            <StackPanel Orientation="Horizontal">

                                                                                <!-- Bit 7 -->
                                                                                <StackPanel Orientation="Vertical">
                                                                                    <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=128}"
                                        Tag="{Binding Bits[8]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[8].Name}"
                                        ToolTip="{Binding Bits[8].Description}" />
                                                                                    <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 7" />
                                                                                </StackPanel>

                                                                                <!-- Bit 6 -->
                                                                                <StackPanel Orientation="Vertical">
                                                                                    <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=64}"
                                        Tag="{Binding Bits[9]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[9].Name}"
                                        ToolTip="{Binding Bits[9].Description}" />
                                                                                    <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 6" />
                                                                                </StackPanel>

                                                                                <!-- Bit 5 -->
                                                                                <StackPanel Orientation="Vertical">
                                                                                    <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=32}"
                                        Tag="{Binding Bits[10]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[10].Name}"
                                        ToolTip="{Binding Bits[10].Description}" />
                                                                                    <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 5" />
                                                                                </StackPanel>

                                                                                <!-- Bit 4 -->
                                                                                <StackPanel Orientation="Vertical">
                                                                                    <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=16}"
                                        Tag="{Binding Bits[11]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[11].Name}"
                                        ToolTip="{Binding Bits[11].Description}" />
                                                                                    <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 4" />
                                                                                </StackPanel>

                                                                                <!-- Bit 3 -->
                                                                                <StackPanel Orientation="Vertical">
                                                                                    <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=8}"
                                        Tag="{Binding Bits[12]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[12].Name}"
                                        ToolTip="{Binding Bits[12].Description}" />
                                                                                    <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 3" />
                                                                                </StackPanel>

                                                                                <!-- Bit 2 -->
                                                                                <StackPanel Orientation="Vertical">
                                                                                    <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=4}"
                                        Tag="{Binding Bits[13]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[13].Name}"
                                        ToolTip="{Binding Bits[13].Description}" />
                                                                                    <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 2" />
                                                                                </StackPanel>

                                                                                <!-- Bit 1 -->
                                                                                <StackPanel Orientation="Vertical">
                                                                                    <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=2}"
                                        Tag="{Binding Bits[14]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[14].Name}"
                                        ToolTip="{Binding Bits[14].Description}" />
                                                                                    <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 1" />
                                                                                </StackPanel>

                                                                                <!-- Bit 0 -->
                                                                                <StackPanel Orientation="Vertical">
                                                                                    <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=1}"
                                        Tag="{Binding Bits[15]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[15].Name}"
                                        ToolTip="{Binding Bits[15].Description}" />
                                                                                    <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 0" />
                                                                                </StackPanel>
                                                                            </StackPanel>
                                                                        </StackPanel>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Path=Size}" Value="1">
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate>
                                                                        <StackPanel Orientation="Horizontal">

                                                                            <!-- Bit 7 -->
                                                                            <StackPanel Orientation="Vertical">
                                                                                <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=128}"
                                        Tag="{Binding Bits[0]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[0].Name}"
                                        ToolTip="{Binding Bits[0].Description}" />
                                                                                <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 7" />
                                                                            </StackPanel>

                                                                            <!-- Bit 6 -->
                                                                            <StackPanel Orientation="Vertical">
                                                                                <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=64}"
                                        Tag="{Binding Bits[1]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[1].Name}"
                                        ToolTip="{Binding Bits[1].Description}" />
                                                                                <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 6" />
                                                                            </StackPanel>

                                                                            <!-- Bit 5 -->
                                                                            <StackPanel Orientation="Vertical">
                                                                                <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=32}"
                                        Tag="{Binding Bits[2]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[2].Name}"
                                        ToolTip="{Binding Bits[2].Description}" />
                                                                                <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 5" />
                                                                            </StackPanel>

                                                                            <!-- Bit 4 -->
                                                                            <StackPanel Orientation="Vertical">
                                                                                <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=16}"
                                        Tag="{Binding Bits[3]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[3].Name}"
                                        ToolTip="{Binding Bits[3].Description}" />
                                                                                <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 4" />
                                                                            </StackPanel>

                                                                            <!-- Bit 3 -->
                                                                            <StackPanel Orientation="Vertical">
                                                                                <ctr:LockableToggleButton 
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=8}"
                                        Tag="{Binding Bits[4]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[4].Name}"
                                        ToolTip="{Binding Bits[4].Description}" />
                                                                                <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 3" />
                                                                            </StackPanel>

                                                                            <!-- Bit 2 -->
                                                                            <StackPanel Orientation="Vertical">
                                                                                <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=4}"
                                        Tag="{Binding Bits[5]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[5].Name}"
                                        ToolTip="{Binding Bits[5].Description}" />
                                                                                <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 2" />
                                                                            </StackPanel>

                                                                            <!-- Bit 1 -->
                                                                            <StackPanel Orientation="Vertical">
                                                                                <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=2}"
                                        Tag="{Binding Bits[6]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[6].Name}"
                                        ToolTip="{Binding Bits[6].Description}" />
                                                                                <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 1" />
                                                                            </StackPanel>

                                                                            <!-- Bit 0 -->
                                                                            <StackPanel Orientation="Vertical">
                                                                                <ctr:LockableToggleButton
                                        Style="{StaticResource Bit}"
                                        IsError="{Binding LastReadValueError}"
                                        Background="{Binding LastReadValueWithoutFormula, Converter={StaticResource ColorConverter}, ConverterParameter=1}"
                                        Tag="{Binding Bits[7]}"
                                        Command="{Binding DataContext.ToggleBitCommand, ElementName=dataGrid}"
                                        CommandParameter="{Binding Tag, RelativeSource={RelativeSource Self}}"
                                        Content="{Binding Bits[7].Name}"
                                        ToolTip="{Binding Bits[7].Description}" />
                                                                                <TextBlock Style="{StaticResource BitNameStyle}" Text="Bit 0" />
                                                                            </StackPanel>
                                                                        </StackPanel>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </ContentControl.Style>
                                        </ContentControl>
                                    </StackPanel>
                                </Grid>

                            </DataTemplate>
                        </DataGrid.RowDetailsTemplate>
                    </DataGrid>
                </Grid>
            </TabItem>
            <TabItem Header="MTP Programming" GotFocus="TabItem_GotFocus" >
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="0.75*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="0.5*"/>
                        <RowDefinition Height="0.5*"/>
                        <RowDefinition Height="0.5*"/>
                        <RowDefinition Height="0.5*"/>
                        <RowDefinition Height="0.5*"/>
                    </Grid.RowDefinitions>

                    <GroupBox Header="Load MTP Registers" Grid.Row="0" Grid.Column="0"
                      Margin="5,0,5,0"
                      FontWeight="Normal"
                      Foreground="#000">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Label x:Name="masterLabel"  Grid.Row="0"  Grid.Column="0" Margin="10,5,5,5" Content="Master Test">
                            </Label>

                            <RadioButton x:Name="onButton" Content="On" Grid.Row="0" Grid.Column="1" Margin="5,10,5,5" 
                                         IsChecked="{Binding IsMasterTestRegisterON, Mode=TwoWay}" 
                                         GroupName="TestRegister" Checked="onButton_Checked"
                                         Command="" CommandParameter="On"/>

                            <RadioButton x:Name="offButton" Content="Off" Grid.Row="0" Grid.Column="2" Margin="0,10,5,5" 
                                         IsChecked="{Binding IsMasterTestRegisterOff , Mode=TwoWay}"
                                         GroupName="TestRegister" Checked="offButton_Checked"
                                         Command="" CommandParameter="Off"/>

                            <Label x:Name="pathLabel"  Grid.Row="1"  Grid.Column="0"  Margin="10,5,5,5" Content="File path">
                            </Label>

                            <TextBox x:Name="fileTextBox" Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" 
                                     HorizontalAlignment="Left" VerticalAlignment="Center"
                                     Margin="5,5,5,5" Text="{Binding MTPPath}" Width="220" Height="25">

                            </TextBox>
                            <Button x:Name="browseButton" Grid.Row="1"  Grid.Column="3" Content="Browse" 
                                    ToolTip="Browse the excel to be read" Click="browseButton_Click"
                                    HorizontalContentAlignment="Center" Width="100" Height="25" Margin="5,5,5,5" HorizontalAlignment="Left">
                            </Button>
                            <Button x:Name="loadButton" Grid.Row="2"  Grid.Column="3"  Content="Load" 
                                    ToolTip="Populate the excel details" Click="loadButton_Click" Visibility="Hidden"
                                    HorizontalContentAlignment="Center" Width="100" Height="25" Margin="5,5,5,5" HorizontalAlignment="Left">
                            </Button>
                        </Grid>

                    </GroupBox>
                    <Label Content="MTP Registers" Grid.Row="1" Grid.Column="0" Height="25" Width="150" HorizontalAlignment="Left"/>
                    <DataGrid x:Name="MTPGrid" Grid.Row="2" Grid.RowSpan="5" Grid.Column="0" Margin="5,5,5,5"
                        AutoGenerateColumns="False"  ItemsSource="{Binding MTPRegisters}"
                        SelectionMode="Extended"
                        CanUserAddRows="False"
                        HorizontalGridLinesBrush="Gainsboro"
                        VerticalGridLinesBrush="Gainsboro"
                        CellStyle="{StaticResource DataGridCell}"
                        RowStyle="{StaticResource DataGridRow}" FontSize="12"
                        BorderBrush="{x:Null}">
                        <DataGrid.Columns>
                            <DataGridTextColumn x:Name="NameColumn" Header="Name"
                                    Binding="{Binding MTPName}"
                                    IsReadOnly="True"
                                    CanUserReorder="True" Width="*"
                                    HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                    ElementStyle="{Binding Source={StaticResource CellCenterAlign}}"/>

                            <DataGridTextColumn x:Name="AddressColumn" Header="Address"
                                    Binding="{Binding MTPAddress}"
                                    IsReadOnly="True" 
                                    CanUserReorder="True" Width="*"
                                    HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                    ElementStyle="{Binding Source={StaticResource CellCenterAlign}}"/>

                            <DataGridTextColumn x:Name="ValueColumn" Header="Default Data"
                                    Binding="{Binding MTPValue}" 
                                    IsReadOnly="True"
                                    CanUserReorder="True" Width="*"
                                    HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                    ElementStyle="{StaticResource CellCenterAlign}"/>

                            <DataGridTemplateColumn Header="Data" Visibility="Hidden"
                                        IsReadOnly="False"
                                        CanUserReorder="True"
                                        HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                        CellStyle="{StaticResource CellCenterAlign}">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBox
                                      Tag="{Binding ID}"
                                      Text="{Binding MTPValue}"
                                      IsEnabled="{Binding Path=IsEditable}"
                                      l:HexDigitsOnlyBehavior.IsHexDigitOnly="True"
                                      l:LostFocusMessageBehavior.IsLostFocus="True"
                                      Width="80"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                        </DataGrid.Columns>
                    </DataGrid>
                    <GroupBox Header="Program MTP Registers" Grid.Row="0" Grid.Column="1"
                      Margin="5,0,5,0"
                      FontWeight="Normal"
                      Foreground="#000">

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Label x:Name="pageLabel"  Grid.Row="0"  Grid.Column="0" Grid.RowSpan="1" Margin="10,5,5,5" Content="MTP Page">
                            </Label>

                            <ComboBox x:Name="pageCombobox" Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="2" Grid.RowSpan="1"
					                Height="25"
					                ItemsSource="{Binding Pages}"
                                    IsSynchronizedWithCurrentItem="True"
					                ToolTip="Available pages" SelectionChanged="pageCombobox_SelectionChanged"
					                VerticalAlignment="Center" Margin="5,5,20,5"/>
                        </Grid>
                    </GroupBox>
                    <Label Content="Page Registers" Grid.Row="1" Grid.Column="1" Height="25" Width="150" HorizontalAlignment="Left"/>
                    <DataGrid x:Name="pageGrid" Grid.Row="2" Grid.RowSpan="3"  Grid.Column="1" Margin="5,5,5,0"
                        AutoGenerateColumns="False" HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Hidden"
                        ItemsSource="{Binding PageRegisters}"
                        CanUserAddRows="False"
                        SelectionMode="Extended"
                        HorizontalGridLinesBrush="Gainsboro"
                        VerticalGridLinesBrush="Gainsboro"
                        CellStyle="{StaticResource DataGridCell}"
                        RowStyle="{StaticResource DataGridRow}" FontSize="12"
                        BorderBrush="{x:Null}">
                        <DataGrid.Columns>
                            <DataGridTextColumn x:Name="pageName" Header="Name"
                                    Binding="{Binding MTPName}"
                                    IsReadOnly="True"
                                    CanUserReorder="True" Width="*"
                                    HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                    ElementStyle="{Binding Source={StaticResource CellCenterAlign}}"/>

                            <DataGridTextColumn x:Name="pageAddress" Header="Address"
                                    Binding="{Binding MTPAddress}"
                                    IsReadOnly="True" 
                                    CanUserReorder="True" Width="*"
                                    HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                    ElementStyle="{Binding Source={StaticResource CellCenterAlign}}"/>

                            <DataGridTextColumn x:Name="pageDefaultValue" Header="Default Data(0x)"
                                    Binding="{Binding MTPDefaultValue}"
                                    IsReadOnly="False"
                                    CanUserReorder="True" Width="*"  Visibility="Hidden"
                                    HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                    ElementStyle="{Binding Source={StaticResource CellCenterAlign}}"/>

                            <DataGridTemplateColumn Header="Default Data(0x)"
                                        IsReadOnly="False"
                                        CanUserReorder="True"
                                        HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                        CellStyle="{StaticResource CellCenterAlign}">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBox
                                      
                                      Text="{Binding MTPDefaultValue , Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"                                      
                                      IsEnabled="{Binding Path=IsEditable}"
                                      l:HexDigitsOnlyBehavior.IsHexDigitOnly="True"
                                      l:LostFocusMessageBehavior.IsLostFocus="True"
                                      Width="80"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTextColumn x:Name="pageValue" Header="Actual Data(0x)"
                                    Binding="{Binding MTPValue}" 
                                    IsReadOnly="True" 
                                    CanUserReorder="True" Width="*"
                                    HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                    ElementStyle="{Binding Source={StaticResource CellCenterAlign}}"/>

                            <DataGridTextColumn x:Name="rwRegisterInfo" Header="RW Register(0x)"
                                    Binding="{Binding RWRegister}"
                                    IsReadOnly="False" 
                                    CanUserReorder="True" Width="*" Visibility="Hidden"
                                    HeaderStyle="{Binding Source={StaticResource HeaderCellStyle}}"
                                    ElementStyle="{Binding Source={StaticResource CellCenterAlign}}"/>

                        </DataGrid.Columns>
                    </DataGrid>
                    <GroupBox Header="Read/Write to MTP" Grid.Row="5" Grid.Column="1" Margin="5,5,5,5"
                      
                      FontWeight="Normal"
                      Foreground="#000">

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Button x:Name="writeButton" Grid.Row="0"  Grid.Column="1" Content="Write MTP Page" 
                                    ToolTip="Write page values" Click="writeButton_Click"
                                    HorizontalContentAlignment="Center" Width="100" Height="25" Margin="0,5,5,5"
                                    HorizontalAlignment="Left" VerticalAlignment="Center">
                            </Button>

                            <Button x:Name="readButton" Grid.Row="0"  Grid.Column="2" Grid.RowSpan="1" 
                                    ToolTip="Read page values" Click="readButton_Click" Content="Read MTP Page" 
                                    HorizontalContentAlignment="Center" Width="100" Height="25" Margin="0,5,5,5" HorizontalAlignment="Left">
                            </Button>

                            <Button x:Name="exportButton" Grid.Row="0"  Grid.Column="3" Content="Export"
                                    ToolTip="Export the grid" Click="exportButton_Click" Command="{Binding CopyAsCsvCommand}" CommandParameter="{Binding ElementName=MTPGrid}"
                                    HorizontalContentAlignment="Center" Width="100" Height="25" Margin="0,5,5,5"
                                    HorizontalAlignment="Left" VerticalAlignment="Center">
                            </Button>

                        </Grid>
                    </GroupBox>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
